{# ожидает: review #}
<div class="k-review" id="review-{{ review.id }}">
  <div class="k-review__meta">
    <span class="k-review__author">{{ review.user|default:"(Удалён)" }}</span>
    <span class="k-review__date">{{ review.created_at|date:"d.m.Y H:i" }}</span>
  </div>

  <div class="k-review__text">{{ review.text|linebreaksbr }}</div>

  {% if request.user.is_staff or review.user_id == request.user.id %}
    <div class="k-review__actions">
      <button
        class="k-btn k-btn--ghost"
        hx-post="{% url 'shop:product_review_delete' review.product.slug review.pk %}"
        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
        hx-target="closest .k-review"
        hx-swap="outerHTML"
        hx-confirm="Удалить этот отзыв?"
        hx-sync="#reviews:queue"
        type="button"
        title="{% if request.user.is_staff and review.user_id != request.user.id %}Удалить отзыв пользователя {{ review.user|default:'(Удалён)' }}{% else %}Удалить свой отзыв{% endif %}">
          {% if request.user.is_staff and review.user_id != request.user.id %}
            Удалить отзыв пользователя {{ review.user|default:"(Удалён)" }}
          {% else %}
            Удалить
          {% endif %}
      </button>
    </div>
  {% endif %}
</div>
